!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3512cfa2-5d01-419d-9380-298b96f06804",e._sentryDebugIdIdentifier="sentry-dbid-3512cfa2-5d01-419d-9380-298b96f06804")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(76670)}])},81444:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var i=t(85893);t(67294);var o=t(56342),l=e=>{let{children:n}=e;return(0,i.jsx)(o.SV,{beforeCapture:e=>{e.setTag("location","SentryErrorBoundary")},children:n})}},76670:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSP:function(){return el},default:function(){return eo}});var i=t(85893),o=t(9008),l=t.n(o),a=t(15202),r=t.n(a),d=t(67294),s=t(81366),u=t(63702),c=t(10513),v=t(60201),p=t(25834),m=t(70498),E=t(55799),h=t(71397),C=t(79977),T=t(39507),_=t(900),f=t(46503),A=t(19084),g=t(6812),S=t(50319),I=t(33941),N=t(19916),b=t(89884),D=t(81940),L=t(15555),O=t(90797);let x=e=>{let{appointmentId:n,cancelledAt:t,customerPortalParentUrl:i,jobId:o}=e;window.parent.postMessage({appointmentId:parseInt(n,10),cancelledAt:t,jobId:parseInt(o,10),type:O.eG.APPOINTMENT_CANCELLED},i)},y=e=>{let{appointmentId:n,customerPortalParentUrl:t,jobId:i,newEnd:o,newStart:l,oldStart:a}=e;window.parent.postMessage({appointmentId:parseInt(n,10),jobId:parseInt(i,10),newEnd:o,newStart:l,oldStart:a,type:O.eG.APPOINTMENT_RESCHEDULED},t)},j=e=>{let{customerPortalParentUrl:n,error:t,errorCode:i,jobId:o}=e;window.parent.postMessage({error:t,errorCode:i,jobId:parseInt(o,10),type:O.eG.CANCEL_ERROR},n)},w=e=>{let{customerPortalParentUrl:n,jobId:t}=e;window.parent.postMessage({jobId:parseInt(t,10),type:O.eG.RESCHEDULE_CLOSED},n)},M=e=>{let{customerPortalParentUrl:n,error:t,errorCode:i,jobId:o}=e;window.parent.postMessage({error:t,errorCode:i,jobId:parseInt(o,10),type:O.eG.RESCHEDULE_ERROR},n)};var P=t(93321),R=e=>{var n,t,o,l;let{onClose:a}=e,[r]=(0,c.m)(),{getPhrase:s}=(0,A.hO)(),{inMemory:{appointmentCancelOrRescheduleContext:u}}=r,[O,R]=(0,d.useState)(void 0),k=(null==u?void 0:u.timezone)||"UTC",Z="en-US",U=null==u?void 0:u.customerPortalParentUrl,z=null==u?void 0:null===(n=u.appointment)||void 0===n?void 0:n.jobId,{initEndDate:B,initMonthYear:F,initStartDate:G}=(0,d.useMemo)(()=>{let e=new Date,n=(0,D.ag)(e,k),t=new Date(Date.UTC(e.getFullYear(),e.getMonth()));return{initEndDate:n.toISOString(),initMonthYear:(0,b.zW)(t,k).toISOString(),initStartDate:e.toISOString()}},[k]),[H,V]=(0,d.useState)({endDate:B,startDate:G}),Y=(0,d.useMemo)(()=>({input:function(e,n,t){var i,o;if(!e)return{customerId:void 0,endDate:t,isNewCustomer:!1,isNewLocation:!1,issueCategory:P.qE.HVAC,issuePath:"",jobTypeId:"",locationId:void 0,serviceZoneId:"",startDate:n};let{customer:l,jobTypeId:a,location:r,selectedIssues:d,tradeType:s,zoneId:u}=e,c=null==d?void 0:d.map(e=>e.id).join("/");return{customerId:null==l?void 0:l.id,endDate:t,isNewCustomer:null!==(i=null==l?void 0:l.isNew)&&void 0!==i&&i,isNewLocation:null!==(o=null==r?void 0:r.isNew)&&void 0!==o&&o,issueCategory:s||P.qE.HVAC,issuePath:c||"",jobTypeId:null!=a?a:"",locationId:null==r?void 0:r.id,serviceZoneId:null!=u?u:"",startDate:n}}(u,G,B)}),[u,B,G]),K=null==u?void 0:u.rescheduleToken,{data:W,fetchMore:q,loading:Q}=(0,g.aM)(I.NS,{context:K?{headers:{Authorization:"Bearer ".concat(K)}}:void 0,fetchPolicy:"cache-first",notifyOnNetworkStatusChange:!0,onCompleted:e=>{if((null==e?void 0:e.getAvailability.__typename)==="AvailabilityResponse"){let n=e.getAvailability;V(e=>{var t;return{...e,endDate:null!==(t=n.adjustedEndDate)&&void 0!==t?t:e.endDate}})}},skip:!(null==u?void 0:u.selectedIssues)||!(null==u?void 0:u.zoneId)||!K,variables:Y}),[$,{loading:J}]=(0,S.D)(N.L$,{context:K?{headers:{Authorization:"Bearer ".concat(K)}}:void 0,onCompleted:e=>{(null==e?void 0:e.cancelAppointment.__typename)==="CancelAppointmentOutput"?(U&&z&&(null==u?void 0:u.appointment)&&x({appointmentId:u.appointment.id,cancelledAt:e.cancelAppointment.cancelledAt,customerPortalParentUrl:U,jobId:z}),a()):(null==e?void 0:e.cancelAppointment.__typename)==="ErrorResponse"&&U&&z&&j({customerPortalParentUrl:U,error:e.cancelAppointment.message,jobId:z})},onError:e=>{if(U&&z){var n,t,i;j({customerPortalParentUrl:U,error:e.message,errorCode:null===(i=e.graphQLErrors)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:null===(n=t.extensions)||void 0===n?void 0:n.code,jobId:z})}}}),[X,{loading:ee}]=(0,S.D)(N.nB,{context:K?{headers:{Authorization:"Bearer ".concat(K)}}:void 0,onCompleted:e=>{(null==e?void 0:e.rescheduleAppointment.__typename)==="RescheduleAppointmentOutput"?(U&&z&&O&&(null==u?void 0:u.appointment)&&y({appointmentId:u.appointment.id,customerPortalParentUrl:U,jobId:z,newEnd:O.endDate,newStart:O.startDate,oldStart:u.appointment.start}),a()):(null==e?void 0:e.rescheduleAppointment.__typename)==="ErrorResponse"&&U&&z&&M({customerPortalParentUrl:U,error:e.rescheduleAppointment.message,jobId:z})},onError:e=>{if(U&&z){var n,t,i;M({customerPortalParentUrl:U,error:e.message,errorCode:null===(i=e.graphQLErrors)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:null===(n=t.extensions)||void 0===n?void 0:n.code,jobId:z})}}}),en=(null==W?void 0:W.getAvailability.__typename)==="AvailabilityResponse"?W.getAvailability:void 0,et=(0,d.useMemo)(()=>{var e;if(!en||Q)return null;let n=null==u?void 0:u.useNaiveTimezone;return(null!==(e=null==en?void 0:en.timeslots)&&void 0!==e?e:[]).filter(e=>e.hasAvailability&&(!n||(0,b.$0)(new Date(e.startDate),k)>=new Date))},[en,Q,null==u?void 0:u.useNaiveTimezone,k]),ei=(0,d.useCallback)(e=>{if(H.endDate<e.monthYear){let e=new Date(H.endDate),n=(0,D.ag)(new Date(e.getFullYear(),e.getMonth()+1),k);V({endDate:n.toISOString(),startDate:e.toISOString()}),q({variables:{input:{...Y.input,endDate:n.toISOString(),startDate:e.toISOString()}}})}},[H.endDate,k,q,Y.input]),eo=(0,d.useMemo)(()=>({allAppointments:s("TIME_SLOT_SELECT.TYPE_TOGGLE.ALL_APPOINTMENTS"),firstAvailable:s("TIME_SLOT_SELECT.TYPE_TOGGLE.FIRST_AVAILABLE"),firstAvailableList:s("TIME_SLOT_SELECT.TIME_SLOT_LIST.FIRST_AVAILABLE")}),[s]),el=(0,d.useMemo)(()=>{var e;let n=null==u?void 0:null===(e=u.dispatchFeeAmount)||void 0===e?void 0:e.en;if(!n)return;let t=Number(n);return isNaN(t)?void 0:t},[null==u?void 0:null===(t=u.dispatchFeeAmount)||void 0===t?void 0:t.en]),ea=(0,d.useMemo)(()=>(function(e){if(null==e?void 0:e.address)return{city:e.address.city||"",state:e.address.state||"",zip:e.address.zip||""}})(null==u?void 0:u.location),[null==u?void 0:u.location]),er=(0,d.useMemo)(()=>{var e,n;return null!==(n=null==(e=null==u?void 0:u.selectedIssues)?void 0:e.slice(1).map(e=>e.label||""))&&void 0!==n?n:[]},[null==u?void 0:u.selectedIssues]),ed=(0,d.useMemo)(()=>ea?(0,L.T)(ea,!1):"",[ea]),es=(0,d.useCallback)(()=>{},[]),eu=(0,d.useCallback)(e=>{R(e)},[]),ec=(0,d.useCallback)(()=>{$()},[$]),ev=(0,d.useCallback)(()=>{O&&X({variables:{input:{displayEndDate:O.displayEndDate,displayStartDate:O.displayStartDate,end:O.endDate,start:O.startDate}}})},[O,X]),ep=(0,d.useCallback)(()=>{U&&z&&w({customerPortalParentUrl:U,jobId:z}),a()},[U,z,a]);if(!u||u.cancelOnly)return null;let{brandName:em,headerOptions:eE,schedulerTitle:eh,tradeType:eC}=u,{backgroundColor:eT,logoUrl:e_,showText:ef}=eE||{},eA=function(e){let n=null==e?void 0:e.appointment;if((null==n?void 0:n.end)&&(null==n?void 0:n.start))return{displayEndDate:n.arrivalWindowEnd,displayStartDate:n.arrivalWindowStart,endDate:n.end,startDate:n.start}}(u);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.Z,{backgroundColor:eT,brandName:em||"",hideCloseButton:!1,logoUrl:e_,onClose:ep,schedulerTitle:s("APPOINTMENT_RESCHEDULE_OR_CANCEL.TITLE"),showText:ef}),(0,i.jsx)(_.P,{active:J||ee||Q,children:(0,i.jsxs)(E.x,{children:[ea&&ed&&(0,i.jsx)(T.Z,{formattedLocation:ed}),(0,i.jsx)(f.p,{children:(0,i.jsx)(h.Z,{headerText:(null==eh?void 0:eh.en)||"",locale:Z,location:ea,needDivider:!0,onJobEdit:es,selectedOptions:er,timeslot:eA,timeZone:k,tradeType:eC})}),(0,i.jsx)(C.Z,{availableTimeSlots:et,defaultDispatchFee:el,firstAvailableEnabled:null!==(l=null==u?void 0:u.firstAvailableEnabled)&&void 0!==l&&l,initialMonthYear:F,isEditing:!1,isLoading:Q,locale:Z,onClickTimeSlot:eu,onViewStateChange:ei,phrases:eo,scheduleTitle:(null==u?void 0:null===(o=u.scheduleTitle)||void 0===o?void 0:o.en)||"",selectedTimeSlot:O,setSelectedTimeSlot:R,showTimeZone:!(null==u?void 0:u.useNaiveTimezone),timeZone:k}),(0,i.jsx)(m.Z,{actions:[(0,i.jsx)(v.z,{color:"negative","data-testid":"cancel-button",disabled:J||ee,fill:"subtle",fullWidth:!0,loading:J,onClick:ec,outline:!0,children:s("APPOINTMENT_RESCHEDULE_OR_CANCEL.CANCEL_BUTTON")},"cancel-button"),(0,i.jsx)(v.z,{color:"primary","data-testid":"reschedule-button",disabled:!O||J||ee,fill:"solid",fullWidth:!0,loading:ee,onClick:ev,children:s("APPOINTMENT_RESCHEDULE_OR_CANCEL.RESCHEDULE_BUTTON")},"reschedule-button")]})]})})]})},k=t(98470),Z=t(52771);t(84301);var U=t(93717),z=t(49732);t(40682);var B=t(51591);t(47341);var F=t(41227),G=t(65548);t(26642);var H=t(66902);t(46794),t(44752);var V=t(81444);t(84720),t(44908),t(12128),t(53673);var Y=t(69272),K=t(91511),W=t(81315),q=t(82729),Q=t(41686),$=t(25504);function J(){let e=(0,q._)(["\n  background-color: white;\n  border-radius: 6px;\n  height: 200px;\n"]);return J=function(){return e},e}function X(){let e=(0,q._)(["\n  background-color: ",";\n  color: ",";\n"]);return X=function(){return e},e}let ee=(0,Q.ZP)(Y.K)(J()),en=(0,Q.ZP)(v.z)(X(),$.light.colors.surface.primary,$.light.colors.text.onPrimary),et=e=>{let{customerPortalParentUrl:n,jobId:t}=e;window.parent.postMessage({jobId:parseInt(t,10),type:O.eG.CANCEL_CLOSED},n)};var ei=e=>{var n;let{onClose:t}=e,[o]=(0,c.m)(),{getPhrase:l}=(0,A.hO)(),{inMemory:{appointmentCancelOrRescheduleContext:a}}=o,r=null==a?void 0:a.rescheduleToken,d=null==a?void 0:a.customerPortalParentUrl,s=null==a?void 0:null===(n=a.appointment)||void 0===n?void 0:n.jobId,[u,{loading:p}]=(0,S.D)(N.L$,{context:r?{headers:{Authorization:"Bearer ".concat(r)}}:void 0,onCompleted:e=>{(null==e?void 0:e.cancelAppointment.__typename)==="CancelAppointmentOutput"?(d&&s&&(null==a?void 0:a.appointment)&&x({appointmentId:a.appointment.id,cancelledAt:e.cancelAppointment.cancelledAt,customerPortalParentUrl:d,jobId:s}),t()):(null==e?void 0:e.cancelAppointment.__typename)==="ErrorResponse"&&d&&s&&j({customerPortalParentUrl:d,error:e.cancelAppointment.message,jobId:s})},onError:e=>{if(d&&s){var n,t,i;j({customerPortalParentUrl:d,error:e.message,errorCode:null===(i=e.graphQLErrors)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:null===(n=t.extensions)||void 0===n?void 0:n.code,jobId:s})}}}),m=()=>{d&&s&&et({customerPortalParentUrl:d,jobId:s}),t()};return(0,i.jsxs)(ee,{className:"p-3",direction:"column",justifyContent:"space-between",children:[(0,i.jsxs)(Y.K,{direction:"row",justifyContent:"space-between",children:[(0,i.jsx)(K.s,{children:l("APPOINTMENT_CANCEL.TITLE")}),(0,i.jsx)(W.J,{name:"close",onClick:m})]}),(0,i.jsx)(Y.K,{children:l("APPOINTMENT_CANCEL.CONFIRMATION_MESSAGE")}),(0,i.jsxs)(Y.K,{direction:"row",justifyContent:"flex-end",spacing:1,children:[(0,i.jsx)(v.z,{disabled:p,onClick:m,children:l("APPOINTMENT_CANCEL.NO_BUTTON")}),(0,i.jsx)(en,{disabled:p,loading:p,onClick:()=>{u()},children:l("APPOINTMENT_CANCEL.YES_BUTTON")})]})]})};t(34155);var eo=e=>{var n;let{abandonedSessionStatus:t,brandId:o,environment:a,featureFlags:v,initialAppState:p,initialState:m,inlineMode:E,isDemo:h,isRoutingEnabled:C,resolvedValidOrigins:T,schedulerConfigs:_,schedulerId:f,showLinearNavigation:g,userMetadata:S}=e,{handleSetModalVisible:I,modalVisible:N,setModalVisible:b}=(0,H.h)(void 0,{environment:a,pageSource:O.w7.ROOT}),[D,L]=(0,d.useState)(!!p),x=_.find(e=>{let{id:n}=e;return n===f}),y=null!==(n=_.find(e=>{let{isDefault:n,isRoutable:t}=e;return n&&t}))&&void 0!==n?n:_.find(e=>{let{isRoutable:n}=e;return n});return(0,d.useEffect)(()=>{!D&&p&&L(!0)},[I,p,N,D]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsx)("title",{children:"ServiceTitan: Scheduling Pro"}),(0,i.jsx)("meta",{content:"Scheduling Pro booking",name:"description"}),(0,i.jsx)("meta",{content:"noindex,nofollow",name:"robots"}),(0,i.jsx)("meta",{content:"width=device-width, initial-scale=1",name:"viewport"}),(0,i.jsx)("link",{href:"/favicon.ico",rel:"icon",type:"image/x-icon"})]}),(0,i.jsx)("main",{className:"".concat(r().main),children:(0,i.jsx)(c.Z,{abandonedSessionStatus:t,brandId:o,currentScheduler:x,defaultSchedulerNavSequence:null==y?void 0:y.navSequence,initialAppState:p,initialState:m,isCallCenterScheduler:(null==x?void 0:x.mode)===P.ud.CALL_CENTER,isDemo:h,isRoutingEnabled:C,navigationMode:g?P.vt.LINEAR:(null==x?void 0:x.navigationMode)?x.navigationMode:(null==y?void 0:y.navigationMode)?y.navigationMode:P.vt.CARD,schedulerId:f,children:(0,i.jsx)(k.Z,{children:(0,i.jsx)(F.M,{schedulers:_,children:(0,i.jsxs)(B.n,{schedulerConfigs:_,children:[(0,i.jsx)(z.Z,{}),(0,i.jsx)(U.ZP,{directLink:!!p,resolvedValidOrigins:T,schedulerContext:_,children:(0,i.jsx)(A.FS,{phrases:Z,children:(0,i.jsx)(V.Z,{children:(0,i.jsx)(G.Km,{featureFlags:v,children:(0,i.jsxs)(s.Z,{inlineMode:E,isDemo:h,modalVisible:N,setModalVisible:I,shouldOpenModalForDirectLink:D,userMetadata:S,children:[N===O.w8.BOOKING&&(0,i.jsx)(u.Z,{onClose:()=>b(void 0)}),N===O.w8.APPOINTMENT_RESCHEDULE_OR_CANCEL&&(0,i.jsx)(R,{onClose:()=>b(void 0)}),void 0===N||N===O.w8.APPOINTMENT_CANCEL&&(0,i.jsx)(ei,{onClose:()=>b(void 0)})]})})})})})]})})})})})]})},el=!0},26642:function(e,n,t){"use strict";t(34155).env.ALLOW_LOCALHOST_ORIGINS},47341:function(e,n,t){"use strict";t(97334)},12128:function(e,n,t){"use strict";t(97385)}},function(e){e.O(0,[878,481,932,143,765,157,427,915,941,148,373,888,774,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);